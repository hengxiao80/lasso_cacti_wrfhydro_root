# README

This file documents the steps I take to generate the `wrfinput` file for an uncoupled/standalone WRF-Hydro run for CACTI.

## ERA5-land data

- Download hourly ERA5-land data from CDS using `get_era5_land.py`;

- Run `grib_filter` to generate the GRIB1 files for the analysis data, which include variables like soil temperature and moisture.

- Here is a list of all the variables in the analysis part of the ERA5-land data:

  ```
  ecmf_20180801_an_sfc.grib1
  shortName   name        
  lblt        Lake bottom temperature 
  licd        Lake ice depth 
  lict        Lake ice temperature 
  lmld        Lake mix-layer depth 
  lmlt        Lake mix-layer temperature 
  lshf        Lake shape factor 
  ltlt        Lake total layer temperature 
  src         Skin reservoir content 
  skt         Skin temperature 
  asn         Snow albedo 
  rsn         Snow density 
  sd          Snow depth 
  stl1        Soil temperature level 1 
  stl2        Soil temperature level 2 
  stl3        Soil temperature level 3 
  stl4        Soil temperature level 4 
  tsn         Temperature of snow layer 
  swvl1       Volumetric soil water layer 1 
  swvl2       Volumetric soil water layer 2 
  swvl3       Volumetric soil water layer 3 
  swvl4       Volumetric soil water layer 4 
  ```

These analysis variables are all we need to generate `wrfinput` files.

- There are hourly-averaged variables (stepRange=x-x+1)in the `grib1` forecast file:

  ```
  pev         Potential evaporation 
  ro          Runoff     
  es          Snow evaporation 
  sf          Snowfall   
  smlt        Snowmelt   
  ssro        Sub-surface runoff 
  slhf        Surface latent heat flux 
  ssr         Surface net solar radiation 
  str         Surface net thermal radiation 
  sro         Surface runoff 
  sshf        Surface sensible heat flux 
  ssrd        Surface solar radiation downwards 
  strd        Surface thermal radiation downwards 
  e           Evaporation 
  tp          Total precipitation 
  ```

These are all accumulated quantities from the start of the daily forecast cycle (00 UTC) to the validity time (or CDS time). I think the validity time is the time used in the NETCDF files generated by `grib_to_netcdf`.

- and hourly snapshot variables (stepRange=x):

  ```
  10u         10 metre U wind component 
  10v         10 metre V wind component 
  2d          2 metre dewpoint temperature 
  2t          2 metre temperature 
  fal         Forecast albedo 
  lai_hv      Leaf area index, high vegetation 
  lai_lv      Leaf area index, low vegetation 
  sp          Surface pressure 
  ```

- and additional hourly snapshot variables (stepRange=x) in the `grib2` forecast files:

  ```
  snowc       Snow cover 
  sde         Snow depth 
  ```

- and additional hourly averaged one (stepRange=x-x+1):

  ```
  evabs       Evaporation from bare soil 
  evaow       Evaporation from open water surfaces excluding oceans 
  evatc       Evaporation from the top of canopy 
  evavt       Evaporation from vegetation transpiration 
  ```

## GEOGRID

(in `geogrid`)

- Download the static datasets; (`topo_merit_3s` data is copied from Bill)

- Modify `GEOGRID.TBL.arw.noahmp` for processing `topo_merit_3s` (following Bill's steps);

## UNGRIB

(in `ungrib4wrfinput`)

NOTE: You only need the first two hours (only the first hour is used actually) of ERA5-land data for wrfinput_d* generation (see `namelist.wps`).

- Run `link_grib.sh` on ERA5-land data;

- (?) `Vtable` controls which variables are read in. We may want to read in more variables available in ERA5-land. Currently I am just using the stock `Vtable.ECMWF`.

- Run `ungrib.exe`;

## METGRID

(in `metgrid4wrfinput`)

- Modify the original `METGRID.TBL` to remove the mandatory flags for atmospheric data;

- Run `metgrid.exe` on the output from `ungrib.exe` to generate the `met_em.d*` files.

## Generate a cold-start `wrfinput`

(in `create_wrfinput_r`)

- Run `create_wrfinput.R`

## Insert the fields from the `metgrid.exe` output

(in `create_wrfinput`)

- Run `create_wrfinput.py`

- The `wrfinput_d*` files containing ERA5-land input are used for the WRF-Hydro runs (labelled `run01_*` internally).